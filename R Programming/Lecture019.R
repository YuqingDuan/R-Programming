# Lecture019: Data Preprocessing - data.table package

library(data.table)

dt <-
    data.table(
        v1 = c(1, 2),
        v2 = LETTERS[1:3],
        v3 = round(rnorm(
            n = 12, mean = 2, sd = 2
        ), digits = 3),
        v4 = sample(1:20, 12)
    )
#    v1 v2     v3 v4
# 1:  1  A  1.972  8
# 2:  2  B  4.677 15
# 3:  1  C  4.098 17
# 4:  2  A -0.733 14
# 5:  1  B  4.739  2
# 6:  2  C  0.794 12
# 7:  1  A -1.312  1
# 8:  2  B -2.177  4
# 9:  1  C  0.162 16
# 10:  2  A  3.289  3
# 11:  1  B  1.963 13
# 12:  2  C  1.444 11

dt[3:5, ]
#    v1 v2     v3 v4
# 1:  1  C  4.098 17
# 2:  2  A -0.733 14
# 3:  1  B  4.739  2

dt[v2 == 'B']
#    v1 v2     v3 v4
# 1:  2  B  4.677 15
# 2:  1  B  4.739  2
# 3:  2  B -2.177  4
# 4:  1  B  1.963 13

dt[v2 %in% c('A', 'B')]
#    v1 v2     v3 v4
# 1:  1  A  1.972  8
# 2:  2  B  4.677 15
# 3:  2  A -0.733 14
# 4:  1  B  4.739  2
# 5:  1  A -1.312  1
# 6:  2  B -2.177  4
# 7:  2  A  3.289  3
# 8:  1  B  1.963 13

dt[, 1:3]
#    v1 v2     v3
# 1:  1  A  1.972
# 2:  2  B  4.677
# 3:  1  C  4.098
# 4:  2  A -0.733
# 5:  1  B  4.739
# 6:  2  C  0.794
# 7:  1  A -1.312
# 8:  2  B -2.177
# 9:  1  C  0.162
# 10:  2  A  3.289
# 11:  1  B  1.963
# 12:  2  C  1.444

dt[, v3]
# [1]  1.972  4.677  4.098 -0.733  4.739  0.794 -1.312 -2.177  0.162  3.289
# [11]  1.963  1.444

dt[, sum(v4)]
# [1] 116

dt[, list(sum_v4 = sum(v4), mean_v4 = mean(v4))]
#    sum_v4  mean_v4
# 1:    116 9.666667

dt[, list(sum_v3 = sum(v3), mean_v4 = mean(v4))]
#    sum_v3  mean_v4
# 1: 18.916 9.666667

dt[, list(v5 = v4 + 1, v6 = v3 - 1)]
#    v5     v6
# 1:  9  0.972
# 2: 16  3.677
# 3: 18  3.098
# 4: 15 -1.733
# 5:  3  3.739
# 6: 13 -0.206
# 7:  2 -2.312
# 8:  5 -3.177
# 9: 17 -0.838
# 10:  4  2.289
# 11: 14  0.963
# 12: 12  0.444
dt
#    v1 v2     v3 v4
# 1:  1  A  1.972  8
# 2:  2  B  4.677 15
# 3:  1  C  4.098 17
# 4:  2  A -0.733 14
# 5:  1  B  4.739  2
# 6:  2  C  0.794 12
# 7:  1  A -1.312  1
# 8:  2  B -2.177  4
# 9:  1  C  0.162 16
# 10:  2  A  3.289  3
# 11:  1  B  1.963 13
# 12:  2  C  1.444 11

dt[, {
    print(v2)
    plot(x = 1:12, y = v3, col = 'red')
}]

dt[, list(sum_v3 = sum(v3), mean_v4 = mean(v4)), by = v2]
#    v2 sum_v3 mean_v4
# 1:  A  3.216     6.5
# 2:  B  9.202     8.5
# 3:  C  6.498    14.0

dt[, list(sum_v3 = sum(v3), mean_v4 = mean(v4)), by = list(v2, v1)]
#    v2 v1 sum_v3 mean_v4
# 1:  A  1  0.660     4.5
# 2:  B  2  2.500     9.5
# 3:  C  1  4.260    16.5
# 4:  A  2  2.556     8.5
# 5:  B  1  6.702     7.5
# 6:  C  2  2.238    11.5

dt[1:8, list(sum_v3 = sum(v3), mean_v4 = mean(v4)), by = v2]
#    v2 sum_v3   mean_v4
# 1:  A -0.073  7.666667
# 2:  B  7.239  7.000000
# 3:  C  4.892 14.500000

# N
dt[, .N, by = list(v1, v2)]
#    v1 v2 N
# 1:  1  A 2
# 2:  2  B 2
# 3:  1  C 2
# 4:  2  A 2
# 5:  1  B 2
# 6:  2  C 2

dt[, v5 := v4 + 1]
dt
#    v1 v2     v3 v4 v5
# 1:  1  A  1.972  8  9
# 2:  2  B  4.677 15 16
# 3:  1  C  4.098 17 18
# 4:  2  A -0.733 14 15
# 5:  1  B  4.739  2  3
# 6:  2  C  0.794 12 13
# 7:  1  A -1.312  1  2
# 8:  2  B -2.177  4  5
# 9:  1  C  0.162 16 17
# 10:  2  A  3.289  3  4
# 11:  1  B  1.963 13 14
# 12:  2  C  1.444 11 12

dt[, c('v5', 'v6') := list(v3 + 1, v4 - 1)]
dt
#    v1 v2     v3 v4     v5 v6
# 1:  1  A  1.972  8  2.972  7
# 2:  2  B  4.677 15  5.677 14
# 3:  1  C  4.098 17  5.098 16
# 4:  2  A -0.733 14  0.267 13
# 5:  1  B  4.739  2  5.739  1
# 6:  2  C  0.794 12  1.794 11
# 7:  1  A -1.312  1 -0.312  0
# 8:  2  B -2.177  4 -1.177  3
# 9:  1  C  0.162 16  1.162 15
# 10:  2  A  3.289  3  4.289  2
# 11:  1  B  1.963 13  2.963 12
# 12:  2  C  1.444 11  2.444 1

Species
# Error: object 'Species' not found
attach(iris)
Species
# ok
detach(iris)
Species
# Error: object 'Species' not found

setkey(dt, v2)
dt[c('A', 'C')]
#    v1 v2     v3 v4     v5 v6
# 1:  1  A  1.972  8  2.972  7
# 2:  2  A -0.733 14  0.267 13
# 3:  1  A -1.312  1 -0.312  0
# 4:  2  A  3.289  3  4.289  2
# 5:  1  C  4.098 17  5.098 16
# 6:  2  C  0.794 12  1.794 11
# 7:  1  C  0.162 16  1.162 15
# 8:  2  C  1.444 11  2.444 10

dt[c('A', 'Z')]
#    v1 v2     v3 v4     v5 v6
# 1:  1  A  1.972  8  2.972  7
# 2:  2  A -0.733 14  0.267 13
# 3:  1  A -1.312  1 -0.312  0
# 4:  2  A  3.289  3  4.289  2
# 5: NA  Z     NA NA     NA NA

dt[c('A', 'Z'), nomatch = 0]
#    v1 v2     v3 v4     v5 v6
# 1:  1  A  1.972  8  2.972  7
# 2:  2  A -0.733 14  0.267 13
# 3:  1  A -1.312  1 -0.312  0
# 4:  2  A  3.289  3  4.289  2

dt[c('A', 'B'), sum(v4)]
# [1] 60
dt[c('A', 'B'), sum(v4), by = .EACHI]
#    v2 V1
# 1:  A 26
# 2:  B 34










